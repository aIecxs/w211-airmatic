(function(){var D=this,q=D._,n={},f=Array.prototype,m=Object.prototype,l=f.push,e=f.slice,u=f.concat,p=m.toString,A=m.hasOwnProperty,x=f.forEach,y=f.map,w=f.reduce,t=f.reduceRight,F=f.filter,g=f.every,E=f.some,s=f.indexOf,v=f.lastIndexOf,m=Array.isArray,B=Object.keys,H=Function.prototype.bind,d=function(b){if(b instanceof d)return b;if(!(this instanceof d))return new d(b);this._wrapped=b};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=d),exports._=
d):D._=d;d.VERSION="1.5.1";var C=d.each=d.forEach=function(b,k,z){if(null!=b)if(x&&b.forEach===x)b.forEach(k,z);else if(b.length===+b.length)for(var a=0,c=b.length;a<c&&k.call(z,b[a],a,b)!==n;a++);else for(a in b)if(d.has(b,a)&&k.call(z,b[a],a,b)===n)break};d.map=d.collect=function(b,k,z){var a=[];if(null==b)return a;if(y&&b.map===y)return b.map(k,z);C(b,function(b,d,c){a.push(k.call(z,b,d,c))});return a};d.reduce=d.foldl=d.inject=function(b,k,z,a){var c=2<arguments.length;null==b&&(b=[]);if(w&&b.reduce===
w)return a&&(k=d.bind(k,a)),c?b.reduce(k,z):b.reduce(k);C(b,function(b,d,r){c?z=k.call(a,z,b,d,r):(z=b,c=!0)});if(!c)throw new TypeError("Reduce of empty array with no initial value");return z};d.reduceRight=d.foldr=function(b,k,z,a){var c=2<arguments.length;null==b&&(b=[]);if(t&&b.reduceRight===t)return a&&(k=d.bind(k,a)),c?b.reduceRight(k,z):b.reduceRight(k);var r=b.length;if(r!==+r)var h=d.keys(b),r=h.length;C(b,function(d,g,p){g=h?h[--r]:--r;c?z=k.call(a,z,b[g],g,p):(z=b[g],c=!0)});if(!c)throw new TypeError("Reduce of empty array with no initial value");
return z};d.find=d.detect=function(b,k,z){var a;c(b,function(b,d,c){if(k.call(z,b,d,c))return a=b,!0});return a};d.filter=d.select=function(b,k,z){var a=[];if(null==b)return a;if(F&&b.filter===F)return b.filter(k,z);C(b,function(b,d,c){k.call(z,b,d,c)&&a.push(b)});return a};d.reject=function(b,k,z){return d.filter(b,function(b,a,d){return!k.call(z,b,a,d)},z)};d.every=d.all=function(b,k,z){k||(k=d.identity);var a=!0;if(null==b)return a;if(g&&b.every===g)return b.every(k,z);C(b,function(b,d,c){if(!(a=
a&&k.call(z,b,d,c)))return n});return!!a};var c=d.some=d.any=function(b,k,z){k||(k=d.identity);var a=!1;if(null==b)return a;if(E&&b.some===E)return b.some(k,z);C(b,function(b,d,c){if(a||(a=k.call(z,b,d,c)))return n});return!!a};d.contains=d.include=function(b,k){return null==b?!1:s&&b.indexOf===s?-1!=b.indexOf(k):c(b,function(b){return b===k})};d.invoke=function(b,k){var a=e.call(arguments,2),c=d.isFunction(k);return d.map(b,function(b){return(c?k:b[k]).apply(b,a)})};d.pluck=function(b,k){return d.map(b,
function(b){return b[k]})};d.where=function(b,k,a){return d.isEmpty(k)?a?void 0:[]:d[a?"find":"filter"](b,function(b){for(var a in k)if(k[a]!==b[a])return!1;return!0})};d.findWhere=function(b,k){return d.where(b,k,!0)};d.max=function(b,k,a){if(!k&&d.isArray(b)&&b[0]===+b[0]&&65535>b.length)return Math.max.apply(Math,b);if(!k&&d.isEmpty(b))return-Infinity;var c={computed:-Infinity,value:-Infinity};C(b,function(b,d,r){d=k?k.call(a,b,d,r):b;d>c.computed&&(c={value:b,computed:d})});return c.value};d.min=
function(b,k,a){if(!k&&d.isArray(b)&&b[0]===+b[0]&&65535>b.length)return Math.min.apply(Math,b);if(!k&&d.isEmpty(b))return Infinity;var c={computed:Infinity,value:Infinity};C(b,function(b,d,r){d=k?k.call(a,b,d,r):b;d<c.computed&&(c={value:b,computed:d})});return c.value};d.shuffle=function(b){var k,a=0,c=[];C(b,function(b){k=d.random(a++);c[a-1]=c[k];c[k]=b});return c};var a=function(b){return d.isFunction(b)?b:function(k){return k[b]}};d.sortBy=function(b,k,c){var r=a(k);return d.pluck(d.map(b,function(b,
k,a){return{value:b,index:k,criteria:r.call(c,b,k,a)}}).sort(function(b,k){var a=b.criteria,d=k.criteria;if(a!==d){if(a>d||void 0===a)return 1;if(a<d||void 0===d)return-1}return b.index<k.index?-1:1}),"value")};var r=function(b,k,c,r){var h={},g=a(null==k?d.identity:k);C(b,function(k,a){var d=g.call(c,k,a,b);r(h,d,k)});return h};d.groupBy=function(b,k,a){return r(b,k,a,function(b,k,a){(d.has(b,k)?b[k]:b[k]=[]).push(a)})};d.countBy=function(b,k,a){return r(b,k,a,function(b,k){d.has(b,k)||(b[k]=0);
b[k]++})};d.sortedIndex=function(b,k,c,r){c=null==c?d.identity:a(c);k=c.call(r,k);for(var h=0,g=b.length;h<g;){var p=h+g>>>1;c.call(r,b[p])<k?h=p+1:g=p}return h};d.toArray=function(b){return b?d.isArray(b)?e.call(b):b.length===+b.length?d.map(b,d.identity):d.values(b):[]};d.size=function(b){return null==b?0:b.length===+b.length?b.length:d.keys(b).length};d.first=d.head=d.take=function(b,k,a){return null==b?void 0:null==k||a?b[0]:e.call(b,0,k)};d.initial=function(b,k,a){return e.call(b,0,b.length-
(null==k||a?1:k))};d.last=function(b,k,a){return null==b?void 0:null==k||a?b[b.length-1]:e.call(b,Math.max(b.length-k,0))};d.rest=d.tail=d.drop=function(b,k,a){return e.call(b,null==k||a?1:k)};d.compact=function(b){return d.filter(b,d.identity)};var h=function(b,k,a){if(k&&d.every(b,d.isArray))return u.apply(a,b);C(b,function(b){d.isArray(b)||d.isArguments(b)?k?l.apply(a,b):h(b,k,a):a.push(b)});return a};d.flatten=function(b,k){return h(b,k,[])};d.without=function(b){return d.difference(b,e.call(arguments,
1))};d.uniq=d.unique=function(b,k,a,c){d.isFunction(k)&&(c=a,a=k,k=!1);a=a?d.map(b,a,c):b;var r=[],h=[];C(a,function(a,c){(k?c&&h[h.length-1]===a:d.contains(h,a))||(h.push(a),r.push(b[c]))});return r};d.union=function(){return d.uniq(d.flatten(arguments,!0))};d.intersection=function(b){var k=e.call(arguments,1);return d.filter(d.uniq(b),function(b){return d.every(k,function(k){return 0<=d.indexOf(k,b)})})};d.difference=function(b){var k=u.apply(f,e.call(arguments,1));return d.filter(b,function(b){return!d.contains(k,
b)})};d.zip=function(){for(var b=d.max(d.pluck(arguments,"length").concat(0)),k=Array(b),a=0;a<b;a++)k[a]=d.pluck(arguments,""+a);return k};d.object=function(b,a){if(null==b)return{};for(var c={},d=0,r=b.length;d<r;d++)a?c[b[d]]=a[d]:c[b[d][0]]=b[d][1];return c};d.indexOf=function(b,a,c){if(null==b)return-1;var r=0,h=b.length;if(c)if("number"==typeof c)r=0>c?Math.max(0,h+c):c;else return r=d.sortedIndex(b,a),b[r]===a?r:-1;if(s&&b.indexOf===s)return b.indexOf(a,c);for(;r<h;r++)if(b[r]===a)return r;
return-1};d.lastIndexOf=function(b,a,c){if(null==b)return-1;var d=null!=c;if(v&&b.lastIndexOf===v)return d?b.lastIndexOf(a,c):b.lastIndexOf(a);for(c=d?c:b.length;c--;)if(b[c]===a)return c;return-1};d.range=function(b,a,c){1>=arguments.length&&(a=b||0,b=0);c=arguments[2]||1;for(var d=Math.max(Math.ceil((a-b)/c),0),r=0,h=Array(d);r<d;)h[r++]=b,b+=c;return h};var G=function(){};d.bind=function(b,a){var c,r;if(H&&b.bind===H)return H.apply(b,e.call(arguments,1));if(!d.isFunction(b))throw new TypeError;
c=e.call(arguments,2);return r=function(){if(!(this instanceof r))return b.apply(a,c.concat(e.call(arguments)));G.prototype=b.prototype;var d=new G;G.prototype=null;var h=b.apply(d,c.concat(e.call(arguments)));return Object(h)===h?h:d}};d.partial=function(b){var a=e.call(arguments,1);return function(){return b.apply(this,a.concat(e.call(arguments)))}};d.bindAll=function(b){var a=e.call(arguments,1);if(0===a.length)throw Error("bindAll must be passed function names");C(a,function(a){b[a]=d.bind(b[a],
b)});return b};d.memoize=function(b,a){var c={};a||(a=d.identity);return function(){var r=a.apply(this,arguments);return d.has(c,r)?c[r]:c[r]=b.apply(this,arguments)}};d.delay=function(b,a){var c=e.call(arguments,2);return setTimeout(function(){return b.apply(null,c)},a)};d.defer=function(b){return d.delay.apply(d,[b,1].concat(e.call(arguments,1)))};d.throttle=function(b,a,c){var d,r,h,g=null,p=0;c||(c={});var f=function(){p=!1===c.leading?0:new Date;g=null;h=b.apply(d,r)};return function(){var e=
new Date;p||!1!==c.leading||(p=e);var G=a-(e-p);d=this;r=arguments;0>=G?(clearTimeout(g),g=null,p=e,h=b.apply(d,r)):g||!1===c.trailing||(g=setTimeout(f,G));return h}};d.debounce=function(b,a,c){var d,r=null;return function(){var h=this,g=arguments,p=c&&!r;clearTimeout(r);r=setTimeout(function(){r=null;c||(d=b.apply(h,g))},a);p&&(d=b.apply(h,g));return d}};d.once=function(b){var a=!1,c;return function(){if(a)return c;a=!0;c=b.apply(this,arguments);b=null;return c}};d.wrap=function(b,a){return function(){var c=
[b];l.apply(c,arguments);return a.apply(this,c)}};d.compose=function(){var b=arguments;return function(){for(var a=arguments,c=b.length-1;0<=c;c--)a=[b[c].apply(this,a)];return a[0]}};d.after=function(b,a){return function(){if(1>--b)return a.apply(this,arguments)}};d.keys=B||function(b){if(b!==Object(b))throw new TypeError("Invalid object");var a=[],c;for(c in b)d.has(b,c)&&a.push(c);return a};d.values=function(b){var a=[],c;for(c in b)d.has(b,c)&&a.push(b[c]);return a};d.pairs=function(b){var a=
[],c;for(c in b)d.has(b,c)&&a.push([c,b[c]]);return a};d.invert=function(b){var a={},c;for(c in b)d.has(b,c)&&(a[b[c]]=c);return a};d.functions=d.methods=function(b){var a=[],c;for(c in b)d.isFunction(b[c])&&a.push(c);return a.sort()};d.extend=function(b){C(e.call(arguments,1),function(a){if(a)for(var c in a)b[c]=a[c]});return b};d.pick=function(b){var a={},c=u.apply(f,e.call(arguments,1));C(c,function(c){c in b&&(a[c]=b[c])});return a};d.omit=function(b){var a={},c=u.apply(f,e.call(arguments,1)),
r;for(r in b)d.contains(c,r)||(a[r]=b[r]);return a};d.defaults=function(b){C(e.call(arguments,1),function(a){if(a)for(var c in a)void 0===b[c]&&(b[c]=a[c])});return b};d.clone=function(b){return d.isObject(b)?d.isArray(b)?b.slice():d.extend({},b):b};d.tap=function(b,a){a(b);return b};var I=function(b,a,c,r){if(b===a)return 0!==b||1/b==1/a;if(null==b||null==a)return b===a;b instanceof d&&(b=b._wrapped);a instanceof d&&(a=a._wrapped);var h=p.call(b);if(h!=p.call(a))return!1;switch(h){case "[object String]":return b==
String(a);case "[object Number]":return b!=+b?a!=+a:0==b?1/b==1/a:b==+a;case "[object Date]":case "[object Boolean]":return+b==+a;case "[object RegExp]":return b.source==a.source&&b.global==a.global&&b.multiline==a.multiline&&b.ignoreCase==a.ignoreCase}if("object"!=typeof b||"object"!=typeof a)return!1;for(var g=c.length;g--;)if(c[g]==b)return r[g]==a;var g=b.constructor,f=a.constructor;if(g!==f&&!(d.isFunction(g)&&g instanceof g&&d.isFunction(f)&&f instanceof f))return!1;c.push(b);r.push(a);g=0;
f=!0;if("[object Array]"==h){if(g=b.length,f=g==a.length)for(;g--&&(f=I(b[g],a[g],c,r)););}else{for(var e in b)if(d.has(b,e)&&(g++,!(f=d.has(a,e)&&I(b[e],a[e],c,r))))break;if(f){for(e in a)if(d.has(a,e)&&!g--)break;f=!g}}c.pop();r.pop();return f};d.isEqual=function(b,a){return I(b,a,[],[])};d.isEmpty=function(b){if(null==b)return!0;if(d.isArray(b)||d.isString(b))return 0===b.length;for(var a in b)if(d.has(b,a))return!1;return!0};d.isElement=function(b){return!(!b||1!==b.nodeType)};d.isArray=m||function(b){return"[object Array]"==
p.call(b)};d.isObject=function(b){return b===Object(b)};C("Arguments Function String Number Date RegExp".split(" "),function(b){d["is"+b]=function(a){return p.call(a)=="[object "+b+"]"}});d.isArguments(arguments)||(d.isArguments=function(b){return!(!b||!d.has(b,"callee"))});"function"!==typeof/./&&(d.isFunction=function(b){return"function"===typeof b});d.isFinite=function(b){return isFinite(b)&&!isNaN(parseFloat(b))};d.isNaN=function(b){return d.isNumber(b)&&b!=+b};d.isBoolean=function(b){return!0===
b||!1===b||"[object Boolean]"==p.call(b)};d.isNull=function(b){return null===b};d.isUndefined=function(b){return void 0===b};d.has=function(b,a){return A.call(b,a)};d.noConflict=function(){D._=q;return this};d.identity=function(b){return b};d.times=function(b,a,c){for(var d=Array(Math.max(0,b)),r=0;r<b;r++)d[r]=a.call(c,r);return d};d.random=function(b,a){null==a&&(a=b,b=0);return b+Math.floor(Math.random()*(a-b+1))};var J={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};
J.unescape=d.invert(J.escape);var L={escape:RegExp("["+d.keys(J.escape).join("")+"]","g"),unescape:RegExp("("+d.keys(J.unescape).join("|")+")","g")};d.each(["escape","unescape"],function(b){d[b]=function(a){return null==a?"":(""+a).replace(L[b],function(a){return J[b][a]})}});d.result=function(b,a){if(null!=b){var c=b[a];return d.isFunction(c)?c.call(b):c}};d.mixin=function(b){C(d.functions(b),function(a){var c=d[a]=b[a];d.prototype[a]=function(){var b=[this._wrapped];l.apply(b,arguments);b=c.apply(d,
b);return this._chain?d(b).chain():b}})};var O=0;d.uniqueId=function(b){var a=++O+"";return b?b+a:a};d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var M=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},Q=/\\|'|\r|\n|\t|\u2028|\u2029/g;d.template=function(b,a,c){var r;c=d.defaults({},c,d.templateSettings);var h=RegExp([(c.escape||M).source,(c.interpolate||M).source,(c.evaluate||M).source].join("|")+
"|$","g"),g=0,p="__p+='";b.replace(h,function(a,c,d,r,h){p+=b.slice(g,h).replace(Q,function(b){return"\\"+P[b]});c&&(p+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'");d&&(p+="'+\n((__t=("+d+"))==null?'':__t)+\n'");r&&(p+="';\n"+r+"\n__p+='");g=h+a.length;return a});p+="';\n";c.variable||(p="with(obj||{}){\n"+p+"}\n");p="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+p+"return __p;\n";try{r=new Function(c.variable||"obj","_",p)}catch(f){throw f.source=
p,f;}if(a)return r(a,d);a=function(b){return r.call(this,b,d)};a.source="function("+(c.variable||"obj")+"){\n"+p+"}";return a};d.chain=function(b){return d(b).chain()};d.mixin(d);C("pop push reverse shift sort splice unshift".split(" "),function(b){var a=f[b];d.prototype[b]=function(){var c=this._wrapped;a.apply(c,arguments);"shift"!=b&&"splice"!=b||0!==c.length||delete c[0];return this._chain?d(c).chain():c}});C(["concat","join","slice"],function(b){var a=f[b];d.prototype[b]=function(){var b=a.apply(this._wrapped,
arguments);return this._chain?d(b).chain():b}});d.extend(d.prototype,{chain:function(){this._chain=!0;return this},value:function(){return this._wrapped}})}).call(this);var Backbone=Backbone||{};
(function(){var D=[].slice,q=function(f,m,l){var e;f=-1;var u=m.length;switch(l.length){case 0:for(;++f<u;)(e=m[f]).callback.call(e.ctx);break;case 1:for(;++f<u;)(e=m[f]).callback.call(e.ctx,l[0]);break;case 2:for(;++f<u;)(e=m[f]).callback.call(e.ctx,l[0],l[1]);break;case 3:for(;++f<u;)(e=m[f]).callback.call(e.ctx,l[0],l[1],l[2]);break;default:for(;++f<u;)(e=m[f]).callback.apply(e.ctx,l)}},n=Backbone.Events={on:function(f,m,l){this._events||(this._events={});(this._events[f]||(this._events[f]=[])).push({callback:m,
context:l,ctx:l||this});return this},once:function(f,m,l){var e=this,u=_.once(function(){e.off(f,u);m.apply(this,arguments)});u._callback=m;this.on(f,u,l);return this},off:function(f,m,l){var e,u,p,n,q,y,w,t;if(!this._events)return this;if(!f&&!m&&!l)return this._events={},this;n=f?[f]:_.keys(this._events);q=0;for(y=n.length;q<y;q++)if(f=n[q],e=this._events[f]){p=[];if(m||l)for(w=0,t=e.length;w<t;w++)u=e[w],(m&&m!==(u.callback._callback||u.callback)||l&&l!==u.context)&&p.push(u);this._events[f]=p}return this},
trigger:function(f){if(!this._events)return this;var m=D.call(arguments,1),l=this._events[f],e=this._events.all;l&&q(this,l,m);e&&q(this,e,arguments);return this},listenTo:function(f,m,l){var e=this._listeners||(this._listeners={}),u=f._listenerId||(f._listenerId=_.uniqueId("l"));e[u]=f;f.on(m,l||this,this);return this},stopListening:function(f,m,l){var e=this._listeners;if(e){if(f)f.off(m,l,this),m||l||delete e[f._listenerId];else{for(var u in e)e[u].off(null,null,this);this._listeners={}}return this}}};
n.bind=n.on;n.unbind=n.off;"undefined"!==typeof exports&&("undefined"!==typeof module&&module.exports&&(exports=module.exports=n),exports.Backbone=exports.Backbone||Backbone)})();(function(){function D(f,e){var u=(new Date).getTime(),p=Math.max(0,16-(u-n)),m=q.setTimeout(function(){f(u+p)},p);n=u+p;return m}var q=this,n=0,f=["ms","moz","webkit","o"];if("undefined"!==typeof exports)"undefined"!==typeof module&&module.exports&&(exports=module.exports=D),exports.requestAnimationFrame=D;else{for(var m=0;m<f.length&&!q.requestAnimationFrame;++m)q.requestAnimationFrame=q[f[m]+"RequestAnimationFrame"],q.cancelAnimationFrame=q[f[m]+"CancelAnimationFrame"]||q[f[m]+"CancelRequestAnimationFrame"];
q.requestAnimationFrame||(q.requestAnimationFrame=D);q.cancelAnimationFrame||(q.cancelAnimationFrame=function(f){clearTimeout(f)})}})();(function(){function D(){var c=document.body.getBoundingClientRect(),a=this.width=c.width,c=this.height=c.height;this.renderer.setSize(a,c,this.ratio);this.trigger(g.Events.resize,a,c)}var q=this,n=q.Two||{},f=Math.sin,m=Math.cos,l=Math.atan2,e=Math.sqrt,u=Math.abs,p=Math.PI,A=2*p,x=p/2,y=Math.pow,w=Math.max,t=0,F={hasEventListeners:_.isFunction(q.addEventListener),bind:function(c,a,d,h){this.hasEventListeners?c.addEventListener(a,d,!!h):c.attachEvent("on"+a,d);return this},unbind:function(c,a,d,
h){this.hasEventListeners?c.removeEventListeners(a,d,!!h):c.detachEvent("on"+a,d);return this}},g=q.Two=function(c){c=_.defaults(c||{},{fullscreen:!1,width:640,height:480,type:g.Types.svg,autostart:!1});_.each(c,function(a,c){"fullscreen"!==c&&("width"!==c&&"height"!==c&&"autostart"!==c)&&(this[c]=a)},this);_.isElement(c.domElement)&&(this.type=g.Types[c.domElement.tagName.toLowerCase()]);this.renderer=new g[this.type](this);g.Utils.setPlaying.call(this,c.autostart);this.frameCount=0;c.fullscreen?
(c=_.bind(D,this),_.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),_.extend(this.renderer.domElement.style,{display:"block",top:0,left:0,right:0,bottom:0,position:"fixed"}),F.bind(q,"resize",c),c()):_.isElement(c.domElement)||(this.renderer.setSize(c.width,c.height,this.ratio),this.width=c.width,this.height=c.height);this.scene=this.renderer.scene;g.Instances.push(this)};_.extend(g,{Array:q.Float32Array||Array,Types:{webgl:"WebGLRenderer",
svg:"SVGRenderer",canvas:"CanvasRenderer"},Version:"v0.4.0",Identifier:"two-",Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change",remove:"remove",insert:"insert"},Commands:{move:"M",line:"L",curve:"C",close:"Z"},Resolution:8,Instances:[],noConflict:function(){q.Two=n;return this},uniqueId:function(){var c=t;t++;return c},Utils:{Curve:{CollinearityEpsilon:y(10,-30),RecursionLimit:16,CuspLimit:0,Tolerance:{distance:0.25,
angle:0,epsilon:0.01}},devicePixelRatio:q.devicePixelRatio||1,getBackingStoreRatio:function(c){return c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1},getRatio:function(c){return g.Utils.devicePixelRatio/d(c)},setPlaying:function(c){this.playing=!!c;return this},getComputedMatrix:function(c,a){a=a&&a.identity()||new g.Matrix;for(var d=c;d&&d._matrix;){var h=d._matrix.elements;a.multiply(h[0],h[1],h[2],
h[3],h[4],h[5],h[6],h[7],h[8],h[9]);d=d.parent}return a},getComputedScale:function(c){for(var a=1;c&&c._scale;)a*=c._scale,c=c.parent;return a},applySvgAttributes:function(c,a){a.cap="butt";a.join="bevel";_.each(c.attributes,function(c,d){switch(c.nodeName){case "visibility":a.visible=!!c.nodeValue;break;case "stroke-linecap":a.cap=c.nodeValue;break;case "stroke-linejoin":a.join=c.nodeValue;break;case "stroke-miterlimit":a.miter=c.nodeValue;break;case "stroke-width":a.linewidth=parseFloat(c.nodeValue);
break;case "stroke-opacity":case "fill-opacity":a.opacity=c.nodeValue;break;case "fill":a.fill=c.nodeValue;break;case "stroke":a.stroke=c.nodeValue}});return a},read:{svg:function(){return g.Utils.read.g.apply(this,arguments)},g:function(c){var a=new g.Group;this.add(a);_.each(c.childNodes,function(c){var d=c.nodeName;d&&(d=d.replace(/svg\:/ig,"").toLowerCase(),d in g.Utils.read&&(c=g.Utils.read[d].call(this,c),a.add(c)))},this);return g.Utils.applySvgAttributes(c,a)},polygon:function(c,a){var d=
[];c.getAttribute("points").replace(/([\d\.?]+),([\d\.?]+)/g,function(a,c,h){console.log(c,h);d.push(new g.Anchor(parseFloat(c),parseFloat(h)))});var h=(new g.Polygon(d,!a)).noStroke();return g.Utils.applySvgAttributes(c,h)},polyline:function(c){return g.Utils.read.polygon(c,!0)},path:function(c){var a,d,h,p=!1,f=!1,e=c.getAttribute("d").match(/[a-df-z][^a-df-z]*/ig),u=e.length-1,e=_.flatten(_.map(e,function(c,e){var l,m,b=c[0],k=b.toLowerCase();h=c.slice(1).trim();h=h.replace(/(-?\d+(?:\.\d*)?)[eE]([+\-]?\d+)/g,
function(b,a,c){return parseFloat(a)*Math.pow(10,c)});h=h.split(/[\s,]+|(?=\s?[+\-])/);p=b===k;var z,n,A,q;switch(k){case "z":e>=u?f=!0:(m=a.x,l=a.y,l=new g.Anchor(m,l,void 0,void 0,void 0,void 0,g.Commands.close));break;case "m":case "l":m=parseFloat(h[0]);l=parseFloat(h[1]);l=new g.Anchor(m,l,void 0,void 0,void 0,void 0,"m"===k?g.Commands.move:g.Commands.line);p&&l.addSelf(a);a=l;break;case "h":case "v":m="h"===k?"x":"y";b="x"===m?"y":"x";l=new g.Anchor(void 0,void 0,void 0,void 0,void 0,void 0,
g.Commands.line);l[m]=parseFloat(h[0]);l[b]=a[b];p&&(l[m]+=a[m]);a=l;break;case "s":case "c":l=a.x;b=a.y;d||(d=(new g.Vector).copy(a));"c"===k?(z=parseFloat(h[0]),m=parseFloat(h[1]),k=parseFloat(h[2]),n=parseFloat(h[3]),A=parseFloat(h[4]),q=parseFloat(h[5])):(n=g.Utils.getReflection(a,d,p),z=n.x,m=n.y,k=parseFloat(h[0]),n=parseFloat(h[1]),A=parseFloat(h[2]),q=parseFloat(h[3]));p&&(z+=l,m+=b,k+=l,n+=b,A+=l,q+=b);_.isObject(a.controls)||g.Anchor.AppendCurveProperties(a);a.controls.right.set(z,m);a=
l=new g.Anchor(A,q,k,n,void 0,void 0,g.Commands.curve);d=l.controls.left;break;case "t":case "q":l=a.x;b=a.y;d||(d=(new g.Vector).copy(a));d.isZero()?(z=l,m=b):(z=d.x,b=d.y);"q"===k?(k=parseFloat(h[0]),n=parseFloat(h[1]),A=parseFloat(h[1]),q=parseFloat(h[2])):(n=g.Utils.getReflection(a,d,p),k=n.x,n=n.y,A=parseFloat(h[0]),q=parseFloat(h[1]));p&&(z+=l,m+=b,k+=l,n+=b,A+=l,q+=b);_.isObject(a.controls)||g.Anchor.AppendCurveProperties(a);a.controls.right.set(z,m);a=l=new g.Anchor(A,q,k,n,void 0,void 0,
g.Commands.curve);d=l.controls.left;break;case "a":throw new g.Utils.Error("not yet able to interpret Elliptical Arcs.");}return l}));if(!(1>=e.length))return e=_.compact(e),e=(new g.Polygon(e,f,void 0,!0)).noStroke(),g.Utils.applySvgAttributes(c,e)},circle:function(c){var a=parseFloat(c.getAttribute("cx")),d=parseFloat(c.getAttribute("cy")),h=parseFloat(c.getAttribute("r")),p=g.Resolution,e=_.map(_.range(p),function(a){var c=a/p*A;a=h*m(c);c=h*f(c);return new g.Anchor(a,c)},this),e=(new g.Polygon(e,
!0,!0)).noStroke();e.translation.set(a,d);return g.Utils.applySvgAttributes(c,e)},ellipse:function(c){var a=parseFloat(c.getAttribute("cx")),d=parseFloat(c.getAttribute("cy")),h=parseFloat(c.getAttribute("rx")),p=parseFloat(c.getAttribute("ry")),e=g.Resolution,l=_.map(_.range(e),function(a){var c=a/e*A;a=h*m(c);c=p*f(c);return new g.Anchor(a,c)},this),l=(new g.Polygon(l,!0,!0)).noStroke();l.translation.set(a,d);return g.Utils.applySvgAttributes(c,l)},rect:function(c){var a=parseFloat(c.getAttribute("x")),
d=parseFloat(c.getAttribute("y")),h=parseFloat(c.getAttribute("width")),p=parseFloat(c.getAttribute("height")),h=h/2,p=p/2,e=[new g.Anchor(h,p),new g.Anchor(-h,p),new g.Anchor(-h,-p),new g.Anchor(h,-p)],e=(new g.Polygon(e,!0)).noStroke();e.translation.set(a+h,d+p);return g.Utils.applySvgAttributes(c,e)},line:function(c){var a=parseFloat(c.getAttribute("x1")),d=parseFloat(c.getAttribute("y1")),h=parseFloat(c.getAttribute("x2")),p=parseFloat(c.getAttribute("y2")),h=(h-a)/2,p=(p-d)/2,e=[new g.Anchor(-h,
-p),new g.Anchor(h,p)],e=(new g.Polygon(e)).noFill();e.translation.set(a+h,d+p);return g.Utils.applySvgAttributes(c,e)}},subdivide:function(c,a,d,h,e,f,m,n,q,t){var s=g.Utils.Curve.CollinearityEpsilon;t=t||g.Utils.Curve.RecursionLimit;var y=g.Utils.Curve.CuspLimit,b=g.Utils.Curve.Tolerance,k,z,x,v;q=q||0;if(q>t)return[];if(C(d,h,c,a,m,n)&&C(e,f,c,a,m,n))return x=m-c,v=n-a,d=w(t-q,1),z=d-1,_.map(_.range(d),function(b){b/=z;return new g.Anchor(x*b+c,v*b+a)});var D=(c+d)/2,E=(a+h)/2,B=(d+e)/2,F=(h+f)/
2,H=(e+m)/2,X=(f+n)/2,Y=(D+B)/2,Z=(E+F)/2,B=(B+H)/2,F=(F+X)/2,R=(Y+B)/2,S=(Z+F)/2;x=m-c;v=n-a;k=u((d-m)*v-(h-n)*x);var N=u((e-m)*v-(f-n)*x);if(0<q){if(k>s&&N>s&&(k+N)*(k+N)<=b.distance*(x*x+v*v)){if(b.angle<b.epsilon)return[new g.Anchor(R,S)];k=l(f-h,e-d);s=u(k-l(h-a,d-c));k=u(l(n-f,m-e)-k);s>=p&&(s=A-s);k>=p&&(k=A-k);if(s+k<b.angle)return[new g.Anchor(R,S)];if(0!==y){if(s>y)return[new g.Anchor(d,h)];if(k>y)return[new g.Anchor(e,f)]}}}else if(k>s)if(k*k<=b.distance*(x*x+v*v)){if(b.angle<b.epsilon)return[new g.Anchor(R,
S)];s=u(l(f-h,e-d)-l(h-a,d-c));s>=p&&(s=A-s);if(s<b.angle)return[new g.Anchor(d,h),new g.Anchor(e,f)];if(0!==y&&s>y)return[new g.Anchor(d,h)]}else if(N>s){if(N*N<=b.distance*(x*x+v*v)){if(b.angle<b.epsilon)return[new g.Anchor(R,S)];s=u(l(n-f,m-e)-l(f-h,e-d));s>=p&&(s=A-s);if(s<b.angle)return[new g.Anchor(d,h),new g.Anchor(e,f)];if(0!==y&&s>y)return[new g.Anchor(e,f)]}}else if(x=R-(c+m)/2,v=S-(a+n)/2,x*x+v*v<=b.distance)return[new g.Anchor(R,S)];return g.Utils.subdivide(c,a,D,E,Y,Z,R,S,q+1,t).concat(g.Utils.subdivide(R,
S,B,F,H,X,m,n,q+1,t))},pointOnLine:function(c,a,d,h,p,e){var f=g.Utils.Curve.Tolerance.epsilon;if(u((a-h)*(p-d)-(c-d)*(e-h))>f)return!1;c=(c-d)*(p-d)+(a-h)*(e-h);return 0>c||c>(p-d)*(p-d)+(e-h)*(e-h)?!1:!0},getCurveFromPoints:function(c,a){for(var d=c.length,h=d-1,p=0;p<d;p++){var e=c[p];_.isObject(e.controls)||g.Anchor.AppendCurveProperties(e);var f=a?H(p-1,d):Math.max(p-1,0),l=a?H(p+1,d):Math.min(p+1,h);B(c[f],e,c[l]);e._command=0===p?g.Commands.move:g.Commands.curve;e.controls.left.x=_.isNumber(e.controls.left.x)?
e.controls.left.x:e.x;e.controls.left.y=_.isNumber(e.controls.left.y)?e.controls.left.y:e.y;e.controls.right.x=_.isNumber(e.controls.right.x)?e.controls.right.x:e.x;e.controls.right.y=_.isNumber(e.controls.right.y)?e.controls.right.y:e.y}},getControlPoints:function(c,a,d){var h=v(c,a),e=v(d,a);c=E(c,a);d=E(d,a);var l=(h+e)/2;a.u=_.isObject(a.controls.left)?a.controls.left:new g.Vector(a.x,a.y);a.v=_.isObject(a.controls.right)?a.controls.right:new g.Vector(a.x,a.y);if(1E-4>c||1E-4>d)return a.controls.left.copy(a),
a.controls.right.copy(a),a;c*=0.33;d*=0.33;l=e<h?l+x:l-x;a.controls.left.x=a.x+m(l)*c;a.controls.left.y=a.y+f(l)*c;l-=p;a.controls.right.x=a.x+m(l)*d;a.controls.right.y=a.y+f(l)*d;return a},getReflection:function(c,a,d){var h=c.distanceTo(a);if(1E-4>=h)return d?new g.Vector:c.clone();a=v(c,a);return new g.Vector(h*Math.cos(a)+(d?0:c.x),h*Math.sin(a)+(d?0:c.y))},angleBetween:function(c,a){var d,h;if(4<=arguments.length)return d=arguments[0]-arguments[2],h=arguments[1]-arguments[3],l(h,d);d=c.x-a.x;
h=c.y-a.y;return l(h,d)},distanceBetweenSquared:function(c,a){var d=c.x-a.x,h=c.y-a.y;return d*d+h*h},distanceBetween:function(c,a){return e(s(c,a))},mod:function(c,a){for(;0>c;)c+=a;return c%a},Collection:function(){Array.call(this);1<arguments.length?Array.prototype.push.apply(this,arguments):arguments[0]&&Array.isArray(arguments[0])&&Array.prototype.push.apply(this,arguments[0])},Error:function(c){this.name="two.js";this.message=c}}});g.Utils.Error.prototype=Error();g.Utils.Error.prototype.constructor=
g.Utils.Error;g.Utils.Collection.prototype=[];g.Utils.Collection.constructor=g.Utils.Collection;_.extend(g.Utils.Collection.prototype,Backbone.Events,{pop:function(){var c=Array.prototype.pop.apply(this,arguments);this.trigger(g.Events.remove,[c]);return c},shift:function(){var c=Array.prototype.shift.apply(this,arguments);this.trigger(g.Events.remove,[c]);return c},push:function(){var c=Array.prototype.push.apply(this,arguments);this.trigger(g.Events.insert,arguments);return c},unshift:function(){var c=
Array.prototype.unshift.apply(this,arguments);this.trigger(g.Events.insert,arguments);return c},splice:function(){var c=Array.prototype.splice.apply(this,arguments),a;this.trigger(g.Events.remove,c);2<arguments.length&&(a=this.slice(arguments[0],arguments.length-2),this.trigger(g.Events.insert,a));return c}});var E=g.Utils.distanceBetween,s=g.Utils.distanceBetweenSquared,v=g.Utils.angleBetween,B=g.Utils.getControlPoints,H=g.Utils.mod,d=g.Utils.getBackingStoreRatio,C=g.Utils.pointOnLine;_.extend(g.prototype,
Backbone.Events,{appendTo:function(c){c.appendChild(this.renderer.domElement);return this},play:function(){g.Utils.setPlaying.call(this,!0);return this.trigger(g.Events.play)},pause:function(){this.playing=!1;return this.trigger(g.Events.pause)},update:function(){var c=!!this._lastFrame,a=(q.performance&&q.performance.now?q.performance:Date).now();this.frameCount++;c&&(this.timeDelta=parseFloat((a-this._lastFrame).toFixed(3)));this._lastFrame=a;var c=this.width,a=this.height,d=this.renderer;c===d.width&&
a===d.height||d.setSize(c,a,this.ratio);this.trigger(g.Events.update,this.frameCount,this.timeDelta);return this.render()},render:function(){this.renderer.render();return this.trigger(g.Events.render,this.frameCount)},add:function(c){var a=c;_.isArray(c)||(a=_.toArray(arguments));this.scene.add(a);return this},remove:function(c){var a=c;_.isArray(c)||(a=_.toArray(arguments));this.scene.remove(a);return this},clear:function(){this.scene.remove(_.toArray(this.scene.children));return this},makeLine:function(c,
a,d,h){d=(d-c)/2;h=(h-a)/2;var e=[new g.Anchor(-d,-h),new g.Anchor(d,h)],e=(new g.Polygon(e)).noFill();e.translation.set(c+d,a+h);this.scene.add(e);return e},makeRectangle:function(c,a,d,h){d/=2;h/=2;h=[new g.Anchor(d,h),new g.Anchor(-d,h),new g.Anchor(-d,-h),new g.Anchor(d,-h)];h=new g.Polygon(h,!0);h.translation.set(c,a);this.scene.add(h);return h},makeCircle:function(c,a,d){return this.makeEllipse(c,a,d,d)},makeEllipse:function(c,a,d,h){var e=g.Resolution,p=_.map(_.range(e),function(a){var c=a/
e*A;a=d*m(c);c=h*f(c);return new g.Anchor(a,c)},this),p=new g.Polygon(p,!0,!0);p.translation.set(c,a);this.scene.add(p);return p},makeCurve:function(c){var a=arguments.length,d=c;if(!_.isArray(c))for(var d=[],e=0;e<a;e+=2){var p=arguments[e];if(!_.isNumber(p))break;d.push(new g.Anchor(p,arguments[e+1]))}var a=arguments[a-1],d=new g.Polygon(d,!(_.isBoolean(a)&&a),!0),a=d.getBoundingClientRect(),f=a.left+a.width/2,l=a.top+a.height/2;_.each(d.vertices,function(a){a.x-=f;a.y-=l});d.translation.set(f,
l);this.scene.add(d);return d},makePolygon:function(c){var a=arguments.length,d=c;if(!_.isArray(c))for(var d=[],e=0;e<a;e+=2){var p=arguments[e];if(!_.isNumber(p))break;d.push(new g.Anchor(p,arguments[e+1]))}a=arguments[a-1];d=new g.Polygon(d,!(_.isBoolean(a)&&a));a=d.getBoundingClientRect();d.center().translation.set(a.left+a.width/2,a.top+a.height/2);this.scene.add(d);return d},makeGroup:function(c){var a=c;_.isArray(c)||(a=_.toArray(arguments));var d=new g.Group;this.scene.add(d);d.add(a);return d},
interpret:function(c){var a=c.tagName.toLowerCase();if(!(a in g.Utils.read))return null;c=g.Utils.read[a].call(this,c);this.add(c);return c}});(function(){requestAnimationFrame(arguments.callee);_.each(g.Instances,function(c){c.playing&&c.update()})})();"function"===typeof define&&define.amd?define(function(){return g}):"undefined"!=typeof module&&module.exports&&(module.exports=g)})();(function(){var D,q,n,f,m=Two.Vector=function(e,f){this.x=e||0;this.y=f||0};_.extend(m.prototype,Backbone.Events,{set:function(e,f){this.x=e;this.y=f;return this},copy:function(e){this.x=e.x;this.y=e.y;return this},clear:function(){this.y=this.x=0;return this},clone:function(){return new m(this.x,this.y)},add:function(e,f){this.x=e.x+f.x;this.y=e.y+f.y;return this},addSelf:function(e){this.x+=e.x;this.y+=e.y;return this},sub:function(e,f){this.x=e.x-f.x;this.y=e.y-f.y;return this},subSelf:function(e){this.x-=
e.x;this.y-=e.y;return this},multiplySelf:function(e){this.x*=e.x;this.y*=e.y;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;return this},divideScalar:function(e){e?(this.x/=e,this.y/=e):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},
distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){n=this.x-e.x;f=this.y-e.y;return n*n+f*f},setLength:function(e){return this.normalize().multiplyScalar(e)},equals:function(e){return 1E-4>this.distanceTo(e)},lerp:function(e,f){D=(e.x-this.x)*f+this.x;q=(e.y-this.y)*f+this.y;return this.set(D,q)},isZero:function(){return 1E-4>this.length()},toString:function(){return this.x+","+this.y},toObject:function(){return{x:this.x,y:this.y}}});var l={set:function(e,
f){this._x=e;this._y=f;return this.trigger(Two.Events.change)},copy:function(e){this._x=e.x;this._y=e.y;return this.trigger(Two.Events.change)},clear:function(){this._y=this._x=0;return this.trigger(Two.Events.change)},clone:function(){return new m(this._x,this._y)},add:function(e,f){this._x=e.x+f.x;this._y=e.y+f.y;return this.trigger(Two.Events.change)},addSelf:function(e){this._x+=e.x;this._y+=e.y;return this.trigger(Two.Events.change)},sub:function(e,f){this._x=e.x-f.x;this._y=e.y-f.y;return this.trigger(Two.Events.change)},
subSelf:function(e){this._x-=e.x;this._y-=e.y;return this.trigger(Two.Events.change)},multiplySelf:function(e){this._x*=e.x;this._y*=e.y;return this.trigger(Two.Events.change)},multiplyScalar:function(e){this._x*=e;this._y*=e;return this.trigger(Two.Events.change)},divideScalar:function(e){return e?(this._x/=e,this._y/=e,this.trigger(Two.Events.change)):this.clear()},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this._x*e.x+this._y*e.y},lengthSquared:function(){return this._x*
this._x+this._y*this._y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){n=this._x-e.x;f=this._y-e.y;return n*n+f*f},setLength:function(e){return this.normalize().multiplyScalar(e)},equals:function(e){return 1E-4>this.distanceTo(e)},lerp:function(e,f){D=(e.x-this._x)*f+this._x;q=(e.y-this._y)*f+this._y;return this.set(D,q)},isZero:function(){return 1E-4>
this.length()},toString:function(){return this._x+","+this._y},toObject:function(){return{x:this._x,y:this._y}}},e={get:function(){return this._x},set:function(e){this._x=e;this.trigger(Two.Events.change,"x")}},u={get:function(){return this._y},set:function(e){this._y=e;this.trigger(Two.Events.change,"y")}};Two.Vector.prototype.bind=Two.Vector.prototype.on=function(){this._bound||(this._x=this.x,this._y=this.y,Object.defineProperty(this,"x",e),Object.defineProperty(this,"y",u),_.extend(this,l),this._bound=
!0);Backbone.Events.bind.apply(this,arguments);return this}})();(function(){var D=Two.Commands,q,n,f,m=Two.Anchor=function(f,e,n,p,q,x,y){Two.Vector.call(this,f,e);this._broadcast=_.bind(function(){this.trigger(Two.Events.change)},this);Object.defineProperty(this,"command",{get:function(){return this._command},set:function(e){this._command=e;this._command!==D.curve||_.isObject(this.controls)||m.AppendCurveProperties(this);return this.trigger(Two.Events.change)}});this._command=y||D.move;if(!y)return this;m.AppendCurveProperties(this);_.isNumber(n)&&(this.controls.left.x=
n);_.isNumber(p)&&(this.controls.left.y=p);_.isNumber(q)&&(this.controls.right.x=q);_.isNumber(x)&&(this.controls.right.y=x)};_.extend(m,{AppendCurveProperties:function(f){q=f._x||f.x;n=f._y||f.y;f.controls={left:new Two.Vector(q,n),right:new Two.Vector(q,n)}}});_.extend(m.prototype,Two.Vector.prototype,{listen:function(){_.isObject(this.controls)||m.AppendCurveProperties(this);_.each(this.controls,function(f){f.bind(Two.Events.change,this._broadcast)},this);return this},ignore:function(){_.each(this.controls,
function(f){f.unbind(Two.Events.change,this._broadcast)},this);return this},clone:function(){f=this.controls;return new Two.Anchor(this.x,this.y,f&&f.left.x,f&&f.left.y,f&&f.right.x,f&&f.right.y,this.command)}})})();(function(){_.range(6);var D=Math.cos,q=Math.sin,n=Math.tan,f,m,l,e,u,p,A,x,y,w,t,F,g,E,s,v,B,H,d,C,c,a,r,h,G,I,J,L,O,M,P,Q,b,k,z,ea,V,W,ca,da,$,aa,X,Y,Z,R,S,N,T,ba=[],fa=Two.Matrix=function(a,b,c,d,e,g){this.elements=new Two.Array(9);var f=a;_.isArray(f)||(f=_.toArray(arguments));this.identity().set(f)};_.extend(fa,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(b,e,k){if(3>=e.length)return F,g,E,f=e[0]||0,m=e[1]||0,l=e[2]||0,u=b,F=u[0]*f+u[1]*m+u[2]*l,g=u[3]*f+u[4]*m+u[5]*l,E=u[6]*f+u[7]*m+u[8]*
l,{x:F,y:g,z:E};s=b[0];v=b[1];B=b[2];H=b[3];d=b[4];C=b[5];c=b[6];a=b[7];r=b[8];h=e[0];G=e[1];I=e[2];J=e[3];L=e[4];O=e[5];M=e[6];P=e[7];Q=e[8];k=k||new Two.Array(9);k[0]=s*h+v*J+B*M;k[1]=s*G+v*L+B*P;k[2]=s*I+v*O+B*Q;k[3]=H*h+d*J+C*M;k[4]=H*G+d*L+C*P;k[5]=H*I+d*O+C*Q;k[6]=c*h+a*J+r*M;k[7]=c*G+a*L+r*P;k[8]=c*I+a*O+r*Q;return k}});_.extend(fa.prototype,Backbone.Events,{set:function(b,a,c,d,e,f){t=b;z=arguments.length;_.isArray(t)||(t=_.toArray(arguments));_.each(t,function(b,a){_.isNumber(b)&&(this.elements[a]=
b)},this);return this.trigger(Two.Events.change)},identity:function(){this.set(fa.Identity);return this},multiply:function(e,f,l,p,m,n,u,q,ma){t=arguments;z=t.length;if(1>=z)return _.each(this.elements,function(b,a){this.elements[a]=b*e},this),this.trigger(Two.Events.change);if(3>=z)return F,g,E,e=e||0,f=f||0,l=l||0,m=this.elements,F=m[0]*e+m[1]*f+m[2]*l,g=m[3]*e+m[4]*f+m[5]*l,E=m[6]*e+m[7]*f+m[8]*l,{x:F,y:g,z:E};b=this.elements;k=t;s=b[0];v=b[1];B=b[2];H=b[3];d=b[4];C=b[5];c=b[6];a=b[7];r=b[8];h=
k[0];G=k[1];I=k[2];J=k[3];L=k[4];O=k[5];M=k[6];P=k[7];Q=k[8];this.elements[0]=s*h+v*J+B*M;this.elements[1]=s*G+v*L+B*P;this.elements[2]=s*I+v*O+B*Q;this.elements[3]=H*h+d*J+C*M;this.elements[4]=H*G+d*L+C*P;this.elements[5]=H*I+d*O+C*Q;this.elements[6]=c*h+a*J+r*M;this.elements[7]=c*G+a*L+r*P;this.elements[8]=c*I+a*O+r*Q;return this.trigger(Two.Events.change)},inverse:function(b){f=this.elements;b=b||new Two.Matrix;V=f[0];W=f[1];ca=f[2];da=f[3];$=f[4];aa=f[5];X=f[6];Y=f[7];Z=f[8];R=Z*$-aa*Y;S=-Z*da+
aa*X;N=Y*da-$*X;T=V*R+W*S+ca*N;if(!T)return null;T=1/T;b.elements[0]=R*T;b.elements[1]=(-Z*W+ca*Y)*T;b.elements[2]=(aa*W-ca*$)*T;b.elements[3]=S*T;b.elements[4]=(Z*V-ca*X)*T;b.elements[5]=(-aa*V+ca*da)*T;b.elements[6]=N*T;b.elements[7]=(-Y*V+W*X)*T;b.elements[8]=($*V-W*da)*T;return b},scale:function(b,a){z=arguments.length;1>=z&&(a=b);return this.multiply(b,0,0,0,a,0,0,0,1)},rotate:function(b){l=D(b);ea=q(b);return this.multiply(l,-ea,0,ea,l,0,0,0,1)},translate:function(b,a){return this.multiply(1,
0,b,0,1,a,0,0,1)},skewX:function(b){f=n(b);return this.multiply(1,f,0,0,1,0,0,0,1)},skewY:function(b){f=n(b);return this.multiply(1,0,0,f,1,0,0,0,1)},toString:function(b){this.toArray(b,ba);return ba.join(" ")},toArray:function(b,a){t=this.elements;w=!!a;f=parseFloat(t[0].toFixed(3));m=parseFloat(t[1].toFixed(3));l=parseFloat(t[2].toFixed(3));e=parseFloat(t[3].toFixed(3));u=parseFloat(t[4].toFixed(3));p=parseFloat(t[5].toFixed(3));if(b){A=parseFloat(t[6].toFixed(3));x=parseFloat(t[7].toFixed(3));
y=parseFloat(t[8].toFixed(3));if(w){a[0]=f;a[1]=e;a[2]=A;a[3]=m;a[4]=u;a[5]=x;a[6]=l;a[7]=p;a[8]=y;return}return[f,e,A,m,u,x,l,p,y]}if(w)a[0]=f,a[1]=e,a[2]=m,a[3]=u,a[4]=l,a[5]=p;else return[f,e,m,u,l,p]},clone:function(){f=this.elements[0];m=this.elements[1];l=this.elements[2];e=this.elements[3];u=this.elements[4];p=this.elements[5];A=this.elements[6];x=this.elements[7];y=this.elements[8];return new Two.Matrix(f,m,l,e,u,p,A,x,y)}})})();(function(){var D=Two.Utils.mod,q,n,f,m={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(e,l){f=e;n=document.createElementNS(this.ns,f);"svg"===f&&(l=_.defaults(l||{},{version:this.version}));_.isObject(l)&&m.setAttributes(n,l);return n},setAttribute:function(e,f){this.setAttribute(f,e)},setAttributes:function(e,f){_.each(f,m.setAttribute,e);return this},removeAttribute:function(e,f){this.removeAttribute(f)},removeAttributes:function(e,f){_.each(f,
m.removeAttribute,e);return this},toString:function(e,f){var l=e.length,m=l-1;return _.map(e,function(n,q){var w,t=f?D(q-1,l):Math.max(q-1,0),F=f?D(q+1,l):Math.min(q+1,m),t=e[t],F=e[F],g,E,s,v,B;B=n.x.toFixed(3);v=n.y.toFixed(3);switch(n._command){case Two.Commands.close:w=Two.Commands.close;break;case Two.Commands.curve:g=t.controls&&t.controls.right||t;w=n.controls&&n.controls.left||n;t=g.x.toFixed(3);g=g.y.toFixed(3);E=w.x.toFixed(3);s=w.y.toFixed(3);w=(0===q?Two.Commands.move:Two.Commands.curve)+
" "+t+" "+g+" "+E+" "+s+" "+B+" "+v;break;default:w=(0===q?Two.Commands.move:n._command)+" "+B+" "+v}q>=m&&f&&(n._command===Two.Commands.curve&&(v=n.controls&&n.controls.right||n,B=F.controls&&F.controls.left||F,t=v.x.toFixed(3),g=v.y.toFixed(3),E=B.x.toFixed(3),s=B.y.toFixed(3),B=F.x.toFixed(3),v=F.y.toFixed(3),w+=" C "+t+" "+g+" "+E+" "+s+" "+B+" "+v),w+=" Z");return w}).join(" ")},group:{appendChild:function(e){(n=this.domElement.querySelector("#"+Two.Identifier+e))&&this.elem.appendChild(n)},
removeChild:function(e){(n=this.domElement.querySelector("#"+Two.Identifier+e))&&this.elem.removeChild(n)},renderChild:function(e){m[e._renderer.type].render.call(e,this)},render:function(e){this.update();this._renderer.elem||(this._renderer.elem=m.createElement("g",{id:Two.Identifier+this.id}),e.appendChild(this._renderer.elem));q=this._matrix.manual||this._flagMatrix;var f={domElement:e,elem:this._renderer.elem};q&&this._renderer.elem.setAttribute("transform","matrix("+this._matrix.toString()+")");
_.each(this.children,m.group.renderChild,e);this._flagAdditions&&_.each(this.additions,m.group.appendChild,f);this._flagSubtractions&&_.each(this.subtractions,m.group.removeChild,f);return this.flagReset()}},polygon:{render:function(e){this.update();this._renderer.elem||(this._renderer.elem=m.createElement("path",{id:Two.Identifier+this.id}),e.appendChild(this._renderer.elem));n=this._renderer.elem;(q=this._matrix.manual||this._flagMatrix)&&n.setAttribute("transform","matrix("+this._matrix.toString()+
")");this._flagVertices&&(vertices=m.toString(this._vertices,this._closed),n.setAttribute("d",vertices));this._flagFill&&n.setAttribute("fill",this._fill);this._flagStroke&&n.setAttribute("stroke",this._stroke);this._flagLinewidth&&n.setAttribute("stroke-width",this._linewidth);this._flagOpacity&&(n.setAttribute("stroke-opacity",this._opacity),n.setAttribute("fill-opacity",this._opacity));this._flagVisible&&n.setAttribute("visibility",this._visible?"visible":"hidden");this._flagCap&&n.setAttribute("stroke-linecap",
this._cap);this._flagJoin&&n.setAttribute("stroke-linejoin",this._join);this._flagMiter&&n.setAttribute("stroke-miterlimit",this.miter);return this.flagReset()}}},l=Two[Two.Types.svg]=function(e){this.domElement=e.domElement||m.createElement("svg");this.scene=new Two.Group;this.scene.parent=this};_.extend(l,{Utils:m});_.extend(l.prototype,Backbone.Events,{setSize:function(e,f){this.width=e;this.height=f;m.setAttributes(this.domElement,{width:e,height:f});return this},render:function(){m.group.render.call(this.scene,
this.domElement);return this}})})();(function(){var D=Two.Utils.mod,q=Two.Utils.getRatio,n,f,m,l,e,u,p,A,x,y,w,t,F,g,E,s,v,B,H,d,C,c,a,r,h,G,I,J={group:{renderChild:function(a){J[a._renderer.type].render.call(a,this)},render:function(a){this.update();n=this._matrix.elements;a.save();a.transform(n[0],n[3],n[1],n[4],n[2],n[5]);_.each(this.children,J.group.renderChild,a);a.restore();return this.flagReset()}},polygon:{render:function(q){this.update();n=this._matrix.elements;f=this.stroke;m=this.linewidth;l=this.fill;e=this.opacity;u=this.visible;
p=this.cap;A=this.join;x=this.miter;y=this.closed;w=this._vertices;t=w.length;F=t-1;if(!u)return this;q.save();n&&q.transform(n[0],n[3],n[1],n[4],n[2],n[5]);l&&(q.fillStyle=l);f&&(q.strokeStyle=f);m&&(q.lineWidth=m);x&&(q.miterLimit=x);A&&(q.lineJoin=A);p&&(q.lineCap=p);_.isNumber(e)&&(q.globalAlpha=e);q.beginPath();_.each(w,function(e,f){G=e.x.toFixed(3);I=e.y.toFixed(3);switch(e._command){case Two.Commands.close:q.closePath();break;case Two.Commands.curve:E=y?D(f-1,t):Math.max(f-1,0);g=y?D(f+1,
t):Math.min(f+1,F);s=w[E];v=w[g];c=s.controls&&s.controls.right||s;a=e.controls&&e.controls.left||e;d=c.x.toFixed(3);C=c.y.toFixed(3);B=a.x.toFixed(3);H=a.y.toFixed(3);q.bezierCurveTo(d,C,B,H,G,I);f>=F&&y&&(r=e.controls&&e.controls.right||e,h=v.controls&&v.controls.left||v,d=r.x.toFixed(3),C=r.y.toFixed(3),B=h.x.toFixed(3),H=h.y.toFixed(3),G=v.x.toFixed(3),I=v.y.toFixed(3),q.bezierCurveTo(d,C,B,H,G,I));break;case Two.Commands.line:q.lineTo(G,I);break;case Two.Commands.move:q.moveTo(G,I)}});y&&q.closePath();
q.fill();q.stroke();q.restore();return this.flagReset()}}},L=Two[Two.Types.canvas]=function(a){this.domElement=a.domElement||document.createElement("canvas");this.ctx=this.domElement.getContext("2d");this.overdraw=!1;this.scene=new Two.Group;this.scene.parent=this};_.extend(L,{Utils:J});_.extend(L.prototype,Backbone.Events,{setSize:function(a,c,d){this.width=a;this.height=c;this.ratio=_.isUndefined(d)?q(this.ctx):d;this.domElement.width=a*this.ratio;this.domElement.height=c*this.ratio;_.extend(this.domElement.style,
{width:a+"px",height:c+"px"});return this},render:function(){var a=1===this.ratio;a||(this.ctx.save(),this.ctx.scale(this.ratio,this.ratio));this.overdraw||this.ctx.clearRect(0,0,this.width,this.height);J.group.render.call(this.scene,this.ctx);a||this.ctx.restore();return this}})})();(function(){var D=Two.Matrix.Multiply,q=Two.Utils.mod,n=[1,0,0,0,1,0,0,0,1],f=new Two.Array(9),m=Two.Utils.getRatio,l,e,u,p,A,x,y,w,t,F,g,E,s,v,B,H,d,C,c,a,r,h,G,I,J,L,O,M,P,Q,b,k,z,ea,V,W,ca,da,$,aa,X,Y,Z,R,S,N,T,ba,fa,ga,K,ia,ja,ka,ha,U={canvas:document.createElement("canvas"),uv:new Two.Array([0,0,1,0,0,1,0,1,1,0,1,1]),group:{renderChild:function(a){U[a._renderer.type].render.call(a,this.gl,this.program)},render:function(a,b){this.update();l=this.parent;e=l._matrix&&l._matrix.manual||l._flagMatrix;
u=this._matrix.manual||this._flagMatrix;if(e||u)this._renderer.matrix||(this._renderer.matrix=new Two.Array(9)),this._matrix.toArray(!0,f),D(f,l._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*l._renderer.scale,e&&(this._flagMatrix=!0);_.each(this.children,U.group.renderChild,{gl:a,program:b});return this.flagReset()}},polygon:{render:function(a,b){if(!this._visible||!this._opacity)return this;l=this.parent;e=l._matrix.manual||l._flagMatrix;u=this._matrix.manual||this._flagMatrix;
p=this._flagVertices||this._flagFill||this._flagStroke||this._flagLinewidth||this._flagOpacity||this._flagVisible||this._flagCap||this._flagJoin||this._flagMiter||this._flagScale;this.update();if(e||u)this._renderer.matrix||(this._renderer.matrix=new Two.Array(9)),this._matrix.toArray(!0,f),D(f,l._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*l._renderer.scale;p&&(this._renderer.rect||(this._renderer.rect={}),this._renderer.triangles||(this._renderer.triangles=new Two.Array(12)),
U.getBoundingClientRect(this._vertices,this._linewidth,this._renderer.rect),U.getTriangles(this._renderer.rect,this._renderer.triangles),U.updateBuffer(a,this,b),U.updateTexture(a,this));a.bindBuffer(a.ARRAY_BUFFER,this._renderer.textureCoordsBuffer);a.vertexAttribPointer(b.textureCoords,2,a.FLOAT,!1,0,0);a.bindTexture(a.TEXTURE_2D,this._renderer.texture);a.uniformMatrix3fv(b.matrix,!1,this._renderer.matrix);a.bindBuffer(a.ARRAY_BUFFER,this._renderer.buffer);a.vertexAttribPointer(b.position,2,a.FLOAT,
!1,0,0);a.drawArrays(a.TRIANGLES,0,6);return this.flagReset()}},getBoundingClientRect:function(a,b,e){A=Infinity;x=-Infinity;y=Infinity;w=-Infinity;_.each(a,function(a,b){t=a.x;F=a.y;g;E;s;v;B=a.controls;y=Math.min(F,y);A=Math.min(t,A);x=Math.max(t,x);w=Math.max(F,w);a.controls&&(H=B.left,d=B.right,H&&d&&(g=H.x,E=H.y,s=d.x,v=d.y,g&&(E&&s&&v)&&(y=Math.min(E,v,y),A=Math.min(g,s,A),x=Math.max(g,s,x),w=Math.max(E,v,w))))});_.isNumber(b)&&(y-=b,A-=b,x+=b,w+=b);C=x-A;c=w-y;e.top=y;e.left=A;e.right=x;e.bottom=
w;e.width=C;e.height=c;e.centroid||(e.centroid={});e.centroid.x=-A;e.centroid.y=-y},getTriangles:function(a,b){y=a.top;A=a.left;x=a.right;w=a.bottom;b[0]=A;b[1]=y;b[2]=x;b[3]=y;b[4]=A;b[5]=w;b[6]=A;b[7]=w;b[8]=x;b[9]=y;b[10]=x;b[11]=w},updateCanvas:function(c){a=c._vertices;r=this.canvas;h=this.ctx;G=c._renderer.scale;I=c._stroke;J=c._linewidth*G;L=c._fill;O=c._opacity;M=c._cap;P=c._join;Q=c._miter;b=c._closed;k=a.length;z=k-1;r.width=Math.max(Math.ceil(c._renderer.rect.width*G),1);r.height=Math.max(Math.ceil(c._renderer.rect.height*
G),1);ea=c._renderer.rect.centroid;V=ea.x*G;W=ea.y*G;h.clearRect(0,0,r.width,r.height);L&&(h.fillStyle=L);I&&(h.strokeStyle=I);J&&(h.lineWidth=J);Q&&(h.miterLimit=Q);P&&(h.lineJoin=P);M&&(h.lineCap=M);_.isNumber(O)&&(h.globalAlpha=O);h.beginPath();_.each(a,function(c,d){ca;da;g;s;$;aa;X;Y;Z;R;S;H;t=(c.x*G+V).toFixed(3);F=(c.y*G+W).toFixed(3);switch(c._command){case Two.Commands.close:h.closePath();break;case Two.Commands.curve:da=b?q(d-1,k):Math.max(d-1,0);ca=b?q(d+1,k):Math.min(d+1,z);g=a[da];s=
a[ca];Z=g.controls&&g.controls.right||g;R=c.controls&&c.controls.left||c;X=(Z.x*G+V).toFixed(3);Y=(Z.y*G+W).toFixed(3);$=(R.x*G+V).toFixed(3);aa=(R.y*G+W).toFixed(3);h.bezierCurveTo(X,Y,$,aa,t,F);d>=z&&b&&(S=c.controls&&c.controls.right||c,H=s.controls&&s.controls.left||s,X=(S.x*G+V).toFixed(3),Y=(S.y*G+W).toFixed(3),$=(H.x*G+V).toFixed(3),aa=(H.y*G+W).toFixed(3),t=(s.x*G+V).toFixed(3),F=(s.y*G+W).toFixed(3),h.bezierCurveTo(X,Y,$,aa,t,F));break;case Two.Commands.line:h.lineTo(t,F);break;case Two.Commands.move:h.moveTo(t,
F)}});b&&h.closePath();h.fill();h.stroke()},updateTexture:function(a,b){this.updateCanvas(b);b._renderer.texture&&a.deleteTexture(b._renderer.texture);a.bindBuffer(a.ARRAY_BUFFER,b._renderer.textureCoordsBuffer);b._renderer.texture=a.createTexture();a.bindTexture(a.TEXTURE_2D,b._renderer.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);0>=this.canvas.width||
0>=this.canvas.height||a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(a,b,c){_.isObject(b._renderer.buffer)&&a.deleteBuffer(b._renderer.buffer);b._renderer.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b._renderer.buffer);a.enableVertexAttribArray(c.position);a.bufferData(a.ARRAY_BUFFER,b._renderer.triangles,a.STATIC_DRAW);_.isObject(b._renderer.textureCoordsBuffer)&&a.deleteBuffer(b._renderer.textureCoordsBuffer);b._renderer.textureCoordsBuffer=
a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b._renderer.textureCoordsBuffer);a.enableVertexAttribArray(c.textureCoords);a.bufferData(a.ARRAY_BUFFER,this.uv,a.STATIC_DRAW)},program:{create:function(a,b){N=a.createProgram();_.each(b,function(b){a.attachShader(N,b)});a.linkProgram(N);T=a.getProgramParameter(N,a.LINK_STATUS);if(!T)throw ga=a.getProgramInfoLog(N),a.deleteProgram(N),new Two.Utils.Error("unable to link program: "+ga);return N}},shaders:{create:function(a,b,c){ba=a.createShader(a[c]);a.shaderSource(ba,
b);a.compileShader(ba);fa=a.getShaderParameter(ba,a.COMPILE_STATUS);if(!fa)throw ga=a.getShaderInfoLog(ba),a.deleteShader(ba),new Two.Utils.Error("unable to compile shader "+ba+": "+ga);return ba},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:"attribute vec2 a_position;\nattribute vec2 a_textureCoords;\n\nuniform mat3 u_matrix;\nuniform vec2 u_resolution;\n\nvarying vec2 v_textureCoords;\n\nvoid main() {\n   vec2 projected = (u_matrix * vec3(a_position, 1.0)).xy;\n   vec2 normal = projected / u_resolution;\n   vec2 clipspace = (normal * 2.0) - 1.0;\n\n   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);\n   v_textureCoords = a_textureCoords;\n}",
fragment:"precision mediump float;\n\nuniform sampler2D u_image;\nvarying vec2 v_textureCoords;\n\nvoid main() {\n  gl_FragColor = texture2D(u_image, v_textureCoords);\n}"}};U.ctx=U.canvas.getContext("2d");var la=Two[Two.Types.webgl]=function(a){this.domElement=a.domElement||document.createElement("canvas");this.scene=new Two.Group;this.scene.parent=this;this._renderer={matrix:new Two.Array(n),scale:1};this._flagMatrix=!0;ha=_.defaults(a||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,
preserveDrawingBuffer:!0,overdraw:!1});this.overdraw=ha.overdraw;K=this.ctx=this.domElement.getContext("webgl",ha)||this.domElement.getContext("experimental-webgl",ha);if(!this.ctx)throw new Two.Utils.Error("unable to create a webgl context. Try using another renderer.");ka=U.shaders.create(K,U.shaders.vertex,U.shaders.types.vertex);ja=U.shaders.create(K,U.shaders.fragment,U.shaders.types.fragment);this.program=U.program.create(K,[ka,ja]);K.useProgram(this.program);this.program.position=K.getAttribLocation(this.program,
"a_position");this.program.matrix=K.getUniformLocation(this.program,"u_matrix");this.program.textureCoords=K.getAttribLocation(this.program,"a_textureCoords");K.disable(K.DEPTH_TEST);K.enable(K.BLEND);K.blendEquationSeparate(K.FUNC_ADD,K.FUNC_ADD);K.blendFuncSeparate(K.SRC_ALPHA,K.ONE_MINUS_SRC_ALPHA,K.ONE,K.ONE_MINUS_SRC_ALPHA)};_.extend(la.prototype,Backbone.Events,{setSize:function(a,b,c){this.width=a;this.height=b;this.ratio=_.isUndefined(c)?m(this.ctx):c;this.domElement.width=a*this.ratio;this.domElement.height=
b*this.ratio;_.extend(this.domElement.style,{width:a+"px",height:b+"px"});a*=this.ratio;b*=this.ratio;this._renderer.matrix[0]=this._renderer.matrix[4]=this._renderer.scale=this.ratio;this._flagMatrix=!0;this.ctx.viewport(0,0,a,b);ia=this.ctx.getUniformLocation(this.program,"u_resolution");this.ctx.uniform2f(ia,a,b);return this},render:function(){K=this.ctx;this.overdraw||K.clear(K.COLOR_BUFFER_BIT|K.DEPTH_BUFFER_BIT);U.group.render.call(this.scene,K,this.program);this._flagMatrix=!1;return this}})})();(function(){new Two.Vector;var D,q=Two.Shape=function(n){this._renderer={};this.id=Two.uniqueId();this._matrix=new Two.Matrix;this.translation=new Two.Vector;this.translation.bind(Two.Events.change,_.bind(q.FlagMatrix,this));this.rotation=0;this.scale=1};_.extend(q,Backbone.Events,{FlagMatrix:function(){this._flagMatrix=!0},MakeObservable:function(n){Object.defineProperty(n,"rotation",{get:function(){return this._rotation},set:function(f){this._rotation=f;this._flagMatrix=!0}});Object.defineProperty(n,
"scale",{get:function(){return this._scale},set:function(f){this._scale=f;this._flagScale=this._flagMatrix=!0}})}});_.extend(q.prototype,{_flagMatrix:!0,_rotation:0,_scale:1,addTo:function(n){n.add(this);return this},clone:function(){D=new q;D.translation.copy(this.translation);D.rotation=this.rotation;D.scale=this.scale;_.each(q.Properties,function(n){D[n]=this[n]},this);return D.update()},update:function(){!this._matrix.manual&&this._flagMatrix&&this._matrix.identity().translate(this.translation.x,
this.translation.y).scale(this.scale).rotate(this.rotation);return this},flagReset:function(){this._flagScale=this._flagMatrix=!1;return this}});q.MakeObservable(q.prototype)})();(function(){var D=Math.min,q=Math.max,n=Math.round,f=Two.Utils.getComputedMatrix,m,l,e,u,p,A,x,y,w,t,F,g,E,s,v,B,H,d,C,c,a,r,h,G,I,J,L,O,M,P,Q,b=Two.Polygon=function(a,b,c,d){Two.Shape.call(this);this._renderer.type="polygon";this._closed=!!b;this._curved=!!c;this.beginning=0;this.ending=1;this.fill="#fff";this.stroke="#000";this.opacity=this.linewidth=1;this.visible=!0;this.join=this.cap="round";this.miter=4;this._vertices=[];this.vertices=a;this.automatic=!d};_.extend(b,{Properties:"fill stroke linewidth opacity visible cap join miter closed curved automatic beginning ending".split(" "),
FlagVertices:function(){this._flagVertices=!0},MakeObservable:function(a){Two.Shape.MakeObservable(a);_.each(b.Properties.slice(0,8),function(b){var c="_"+b,d="_flag"+b.charAt(0).toUpperCase()+b.slice(1);Object.defineProperty(a,b,{get:function(){return this[c]},set:function(a){this[c]=a;this[d]=!0}})});Object.defineProperty(a,"closed",{get:function(){return this._closed},set:function(a){this._closed=!!a;this._flagVertices=!0}});Object.defineProperty(a,"curved",{get:function(){return this._curved},
set:function(a){this._curved=!!a;this._flagVertices=!0}});Object.defineProperty(b.prototype,"automatic",{get:function(){return this._automatic},set:function(a){a!==this._automatic&&(method=(this._automatic=!!a)?"ignore":"listen",_.each(this.vertices,function(a){a[method]()}))}});Object.defineProperty(a,"beginning",{get:function(){return this._beginning},set:function(a){this._beginning=D(q(a,0),1);this._flagVertices=!0}});Object.defineProperty(a,"ending",{get:function(){return this._ending},set:function(a){this._ending=
D(q(a,0),1);this._flagVertices=!0}});Object.defineProperty(a,"vertices",{get:function(){return this._collection},set:function(a){var c=_.bind(b.FlagVertices,this),d=_.bind(function(a){_.each(a,function(a){a.bind(Two.Events.change,c)},this);c()},this),e=_.bind(function(a){_.each(a,function(a){a.unbind(Two.Events.change,c)},this);c()},this);this._collection&&this._collection.unbind();this._collection=new Two.Utils.Collection(a.slice(0));this._collection.bind(Two.Events.insert,d);this._collection.bind(Two.Events.remove,
e);verticesChanged=!0;d(this._collection)}})}});_.extend(b.prototype,Two.Shape.prototype,{_flagVertices:!0,_flagFill:!0,_flagStroke:!0,_flagLinewidth:!0,_flagOpacity:!0,_flagVisible:!0,_flagCap:!0,_flagJoin:!0,_flagMiter:!0,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,clone:function(a){a=a||this.parent;y=_.map(this.vertices,function(a){return a.clone()});w=new b(y,this.closed,this.curved,
!this.automatic);_.each(Two.Shape.Properties,function(a){w[a]=this[a]},this);w.translation.copy(this.translation);w.rotation=this.rotation;w.scale=this.scale;a.add(w);return w},noFill:function(){this.fill="transparent";return this},noStroke:function(){this.stroke="transparent";return this},corner:function(){t=this.getBoundingClientRect(!0);F={x:t.left,y:t.top};_.each(this.vertices,function(a){a.subSelf(F)});return this},center:function(){t=this.getBoundingClientRect(!0);t.centroid={x:t.left+t.width/
2,y:t.top+t.height/2};_.each(this.vertices,function(a){a.subSelf(t.centroid)});return this},remove:function(){if(!this.parent)return this;this.parent.remove(this);return this},getBoundingClientRect:function(b){this.update();g=this.linewidth/2;void 0;E=Infinity;s=-Infinity;v=Infinity;B=-Infinity;_.each(this._vertices,function(a){H=a.x;d=a.y;v=D(d,v);E=D(H,E);s=q(H,s);B=q(d,B)});v-=g;E-=g;s+=g;B+=g;h=b?this._matrix:f(this);C=h.multiply(E,v,1);c=h.multiply(s,v,1);a=h.multiply(s,B,1);r=h.multiply(E,B,
1);v=D(C.y,c.y,a.y,r.y);E=D(C.x,c.x,a.x,r.x);s=q(C.x,c.x,a.x,r.x);B=q(C.y,c.y,a.y,r.y);return{top:v,left:E,right:s,bottom:B,width:s-E,height:B-v}},plot:function(){if(this.curved)return Two.Utils.getCurveFromPoints(this.vertices,this.closed),this;_.each(this.vertices,function(a,b){a._command=0===b?Two.Commands.move:Two.Commands.line},this);return this},subdivide:function(a){u=this.vertices.length-1;c=this.vertices[u];p=this._closed||this.vertices[u].command===Two.Commands.close;y=[];_.each(this.vertices,
function(b,d){if(!(0>=d&&!p||b.command===Two.Commands.move)){s=c.controls&&c.controls.right;E=b.controls&&b.controls.left;G=c.x;I=c.y;J=(s||c).x;L=(s||c).y;O=(E||b).x;M=(E||b).y;P=b.x;Q=b.y;var e=_.flatten(Two.Utils.subdivide(G,I,J,L,O,M,P,Q,0,a));y=y.concat(e);_.each(e,function(a,b){a.command=0>=b&&c.command===Two.Commands.move?Two.Commands.move:Two.Commands.line})}c=b},this);this._curved=this._automatic=!1;this.vertices=_.flatten(y);return this},update:function(){if(this._flagVertices)for(this._automatic&&
this.plot(),m=this.vertices.length,u=m-1,l=n(this._beginning*u),e=n(this._ending*u),this._vertices.length=0,x=l;x<e+1;x++)A=this.vertices[x],this._vertices.push(A);Two.Shape.prototype.update.call(this);return this},flagReset:function(){this._flagVertices=this._flagFill=this._flagStroke=this._flagLinewidth=this._flagOpacity=this._flagVisible=this._flagCap=this._flagJoin=this._flagMiter=!1;Two.Shape.prototype.flagReset.call(this);return this}});b.MakeObservable(b.prototype)})();(function(){var D=Math.min,q=Math.max,n,f,m,l,e,u,p,A,x,y,w,t,F,g,E,s,v,B,H,d,C,c=Two.Group=function(a){Two.Shape.call(this,!0);this._renderer.type="group";this.additions=[];this.subtractions=[];this.children={}};_.extend(c,{MakeObservable:function(a){Two.Shape.MakeObservable(a);c.MakeGetterSetter(a,Two.Polygon.Properties)},MakeGetterSetter:function(a,c){_.isArray(c)||(c=[c]);_.each(c,function(c){n="_"+c;Object.defineProperty(a,c,{get:function(){return this[n]},set:function(a){this[n]=a;_.each(this.children,
function(d){d[c]=a})}})})}});_.extend(c.prototype,Two.Shape.prototype,{_flagAdditions:!1,_flagSubtractions:!1,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,clone:function(a){a=a||this.parent;m=_.map(this.children,function(a){return a.clone()});l=new c;a.add(l);l.add(m);l.translation.copy(this.translation);l.rotation=this.rotation;l.scale=this.scale;return l},corner:function(){e=this.getBoundingClientRect(!0);
u={x:e.left,y:e.top};_.each(this.children,function(a){a.translation.subSelf(u)});return this},center:function(){e=this.getBoundingClientRect(!0);e.centroid={x:e.left+e.width/2,y:e.top+e.height/2};_.each(this.children,function(a){a.translation.subSelf(e.centroid)});return this},add:function(a){p=arguments.length;A=a;m=this.children;x=this.parent;y=this.additions;_.isArray(a)||(A=_.toArray(arguments));_.each(A,function(a){a&&(w=a.id,f=a.parent,_.isUndefined(m[w])&&(f&&(delete f.children[w],C=_.indexOf(f.additions,
w),0<=C&&f.additions.splice(C,1)),m[w]=a,a.parent=this,y.push(w),this._flagAdditions=!0))},this);return this},remove:function(a){p=arguments.length;A=a;m=this.children;x=this.parent;y=this.subtractions;if(0>=p&&x)return x.remove(this),this;_.isArray(a)||(A=_.toArray(arguments));_.each(A,function(a){w=a.id;grandchildren=a.children;f=a.parent;w in m&&(delete m[w],delete a.parent,C=_.indexOf(f.additions,w),0<=C&&f.additions.splice(C,1),y.push(w),this._flagSubtractions=!0)});return this},getBoundingClientRect:function(a){this.update();
t=Infinity;F=-Infinity;g=Infinity;E=-Infinity;_.each(this.children,function(a){e=a.getBoundingClientRect(!0);_.isNumber(e.top)&&(_.isNumber(e.left)&&_.isNumber(e.right)&&_.isNumber(e.bottom))&&(g=D(e.top,g),t=D(e.left,t),F=q(e.right,F),E=q(e.bottom,E))},this);s=a?this._matrix:Two.Utils.getComputedMatrix(this);v=s.multiply(t,g,1);B=s.multiply(F,g,1);H=s.multiply(F,E,1);d=s.multiply(t,E,1);g=D(v.y,B.y,H.y,d.y);t=D(v.x,B.x,H.x,d.x);F=q(v.x,B.x,H.x,d.x);E=q(v.y,B.y,H.y,d.y);return{top:g,left:t,right:F,
bottom:E,width:F-t,height:E-g}},noFill:function(){_.each(this.children,function(a){a.noFill()});return this},noStroke:function(){_.each(this.children,function(a){a.noStroke()});return this},subdivide:function(){var a=arguments;_.each(this.children,function(c){c.subdivide.apply(c,a)});return this},flagReset:function(){this._flagAdditions&&(this.additions.length=0,this._flagAdditions=!1);this._flagSubtractions&&(this.subtractions.length=0,this._flagSubtractions=!1);Two.Shape.prototype.flagReset.call(this);
return this}});c.MakeObservable(c.prototype)})();
